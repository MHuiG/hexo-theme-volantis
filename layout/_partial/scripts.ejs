<%- js({src:'https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js',aysc:true}) %>
<%- js('https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js') %>

<% if (theme.search && theme.search.enable) { %>
  <script>
    <% if(theme.search.service === 'baidu') { %>
      var BAIDU_API_ID = "<%- theme.search.baidu.apiId %>";
    <%} else if(theme.search.service === 'algolia') { %>
      var ALGOLIA_API_KEY = "<%- theme.search.algolia.apiKey %>";
      var ALGOLIA_APP_ID = "<%- theme.search.algolia.applicationID %>";
      var ALGOLIA_INDEX_NAME = "<%- theme.search.algolia.indexName %>";
    <%} else if(theme.search.service === 'azure') { %>
      var AZURE_QUERY_KEY = "<%- theme.search.azure.queryKey %>";
      var AZURE_INDEX_NAME = "<%- theme.search.azure.indexName %>";
      var AZURE_SERVICE_NAME = "<%- theme.search.azure.serviceName %>";
    <%} else if(theme.search.service === 'google') { %>
      var GOOGLE_CUSTOM_SEARCH_API_KEY = "<%- theme.search.google.apiKey %>";
      var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "<%- theme.search.google.engineId %>";
    <%}%>
    var SEARCH_SERVICE = "<%- theme.search.service %>" || "hexo";
    var ROOT = "<%- config.root %>" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>
<% } %>

<% if (theme.plugins.Artitalk && theme.plugins.Artitalk.enable) { %>
  <script>
    var appID ="<%=  theme.plugins.Artitalk.appID  %>";
    var appKEY ="<%=  theme.plugins.Artitalk.appKEY  %>";
    <% if(theme.plugins.Artitalk.severurl){ %>
        var severurl="<%=  theme.plugins.Artitalk.severurl  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.slanguage){ %>
        var slanguage="<%=  theme.plugins.Artitalk.slanguage  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.per){ %>
        var per="<%=  theme.plugins.Artitalk.per  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.placeholder1){ %>
        var placeholder1="<%=  theme.plugins.Artitalk.placeholder1  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.placeholder2){ %>
        var placeholder2="<%=  theme.plugins.Artitalk.placeholder2  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.lazy==0){ %>
        var lazy=0;
    <% }else{ %>
        var lazy=1;
    <% }  %>
    <% if(theme.plugins.Artitalk.bgimg){ %>
        var bgimg="<%=  theme.plugins.Artitalk.bgimg  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.color1){ %>
        var color1="<%=  theme.plugins.Artitalk.color1  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.color2){ %>
        var color2="<%=  theme.plugins.Artitalk.color2  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.color3){ %>
        var color3="<%=  theme.plugins.Artitalk.color3  %>";
    <% } %>
  </script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/artitalk"></script>
<% } %>

<% if (theme.plugins.instant_page) { %>
  <script async src="<%- theme.plugins.instant_page %>" type="module" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<% } %>
<% if (theme.plugins.scrollreveal && theme.plugins.scrollreveal.js) { %>
  <script aysc src="<%- theme.plugins.scrollreveal.js %>"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '<%- theme.plugins.scrollreveal.distance %>',
        duration: '<%- theme.plugins.scrollreveal.duration %>',
        interval: '<%- theme.plugins.scrollreveal.interval %>',
        scale: '<%- theme.plugins.scrollreveal.scale %>'
      });
    });
  </script>
  <script type="text/javascript">
      $("body > div.l_body > div > div > section > div:nth-child(3) > article").addClass("reveal");
      $("body > div.l_body > div > div > section > div:nth-child(4) > article").addClass("reveal");
      $("body > div.l_body > div > div > section > div:nth-child(5) > article").addClass("reveal");
  </script>
<% } %>
<% if (theme.plugins.nodewaves && theme.plugins.nodewaves.js) { %>
  <%- js({src: theme.plugins.nodewaves.js,aysc:true}) %>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>
<% } %>


<!--无许处理 - 确认兼容-->
<% if (theme.plugins.backstretch && theme.plugins.backstretch.enable && (theme.plugins.backstretch.images || page.images)) { %>
  <% var imgs = theme.plugins.backstretch.images || page.images; %>
  <% var posi = null;
  if (theme.plugins.backstretch.position == 'cover') {
    posi = '.cover';
  }
   %>
  <% if (imgs != undefined && theme.plugins.backstretch.position != undefined){ %>
    <%- js({src:theme.plugins.backstretch.js,aysc:true}) %>
    <script type="text/javascript">
      $(function(){
        var imgs=<%- '["' + imgs.join('", "') + '"]' %>;
        if ('<%- theme.plugins.backstretch.shuffle %>' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('<%- posi %>') {
          $('<%- posi %>').backstretch(
            imgs,
          {
            duration: "<%- theme.plugins.backstretch.duration %>",
            fade: "<%- theme.plugins.backstretch.fade %>"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "<%- theme.plugins.backstretch.duration %>",
            fade: "<%- theme.plugins.backstretch.fade %>"
          });
        }
      });
    </script>
  <% } %>
<% } %>

<!--似乎不需要处理-->
<% if (theme.plugins.aplayer && theme.plugins.aplayer.enable && theme.plugins.aplayer.js) { %>
  <% (theme.plugins.aplayer.js||[]).forEach(function(item){ %>
    <%- js({src:item,aysc:true}) %>
  <% }) %>
<% } %>

<!--PS：只对 valine 做了 Pjax 兼容-->
<%
  var enableDisqus = false;
  var enableLivere = false;
  var enableGitalk = false;
  var enableVssue = false;
  var enableValine = false;
  var enableMiniValine = false;
  if (theme.comments) {
    if (theme.comments.disqus && theme.comments.disqus.shortname) {
      enableDisqus = true;
    }
    if (theme.comments.livere && theme.comments.livere.uid) {
      enableLivere = true;
    }
    if (theme.comments.gitalk && theme.comments.gitalk.clientID) {
      enableGitalk = true;
    }
    if (theme.comments.vssue && theme.comments.vssue.clientId) {
      enableVssue = true;
    }
    if (theme.comments.valine && theme.comments.valine.appId) {
      enableValine = true;
    }
    if (theme.comments.minivaline && theme.comments.minivaline.appId) {
      enableMiniValine = true;
    }
  }
%>

<% if (enableDisqus){ %>
  <script>
    var disqus_shortname = '<%= theme.comments.disqus.shortname %>';
    <% if (page.permalink){ %>
      var disqus_url = '<%= page.permalink %>';
    <% } %>
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/<% if (page.comments) { %>embed.js<% } else { %>count.js<% } %>';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
<% } %>
<% if (enableLivere){ %>
  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];
      if (typeof LivereTower === 'function') { return; }
      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;
      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
<% } %>
<% if (enableGitalk) { %>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: "<%- theme.comments.gitalk.clientID %>",
      clientSecret: "<%- theme.comments.gitalk.clientSecret %>",
      repo: "<%- theme.comments.gitalk.repo %>",
      owner: "<%- theme.comments.gitalk.owner %>",
      admin: "<%- theme.comments.gitalk.admin %>",
      <% if(page.gitalk && page.gitalk.id) { %>
        id: "<%= page.gitalk.id %>",
      <% } else { %>
        id: location.pathname,      // Ensure uniqueness and length less than 50
      <% } %>
      distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
  </script>
<% } %>
<% if (enableVssue) { %>
  <script src="https://cdn.jsdelivr.net/gh/vuejs/vue@2.6.11/dist/vue.runtime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/meteorlxy/vssue@1.4.4/packages/vssue/dist/vssue.github.min.js"></script>
  <script>
    new Vue({
      el: '#vssue',

      render: h => h('Vssue', {
        props: {
          title: "<%- (page.seo_title || page.title) + ' - ' + config.title %>",
          options: {
            owner: '<%- theme.comments.vssue.owner %>',
            repo: '<%- theme.comments.vssue.repo %>',
            clientId: '<%- theme.comments.vssue.clientId %>',
            clientSecret: '<%- theme.comments.vssue.clientSecret %>',
            prefix: '',
            autoCreateIssue: true,
          },
        }
      })
    })
  </script>
<% } %>
<% if (enableValine){ %>
  <% if (theme.comments.valine.js) { %>
    <%- js(theme.comments.valine.js) %>
  <% } else { %>
    <%- js(['js/valine.js']) %>
  <% } %>
  <% var master = theme.comments.valine.master || [] %>
  <% var friends = theme.comments.valine.friends  || []  %>
  <script>
    var GUEST_INFO = ['nick', 'mail', 'link'];
    var meta = '<%= theme.comments.valine.meta %>'.split(',').filter(function (item) {
      return GUEST_INFO.indexOf(item) > -1
    });
    var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
    var requiredFields = '<%= theme.comments.valine.requiredFields %>'.split(',').filter(function (item) {
      return REQUIRED_FIELDS.indexOf(item) > -1
    });

    function emoji(path, idx, ext) {
      return path + "/" + path + "-" + idx + "." + ext;
    }

    var emojiMaps = {};
    for (var i = 1; i <= 54; i++) {
      emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
    }
    for (var i = 1; i <= 101; i++) {
      emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
    }
    for (var i = 1; i <= 116; i++) {
      emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
    }
    for (var i = 1; i <= 125; i++) {
      emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
    }
    for (var i = 1; i <= 4; i++) {
      emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
    }

    function pjax_valine() {
      var valinePath = $.trim($('#valine-path').text()) === "none" ?
              window.location.pathname : $.trim($('#valine-path').text());

      var valinePlaceholder = $.trim($('#valine-placeholder').text()) === "none" ?
              "<%= theme.comments.valine.placeholder %>" : $.trim($('#valine-placeholder').text());

      var ALLPATH = '<%= theme.comments.valine.path %>';
      if(ALLPATH != '') valinePath = ALLPATH;

      var valine = new Valine();
      valine.init({
        el: '#valine_container',
        meta: meta,
        placeholder: valinePlaceholder,
        path: valinePath,
        appId: "<%= theme.comments.valine.appId %>",
        appKey: "<%= theme.comments.valine.appKey %>",
        pageSize: '<%= theme.comments.valine.pageSize %>',
        avatar: '<%= theme.comments.valine.avatar %>',
        lang: '<%= theme.comments.valine.lang %>',
        visitor: <%= theme.comments.valine.visitor %>,
        highlight: '<%= theme.comments.valine.highlight %>',
        mathJax: '<%= theme.comments.valine.mathJax %>',
        enableQQ: '<%= theme.comments.valine.enableQQ %>',
        requiredFields: requiredFields,
        emojiCDN: 'https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/emoji/valine/',
        emojiMaps: emojiMaps,
        metaPlaceholder: { "nick": "昵称 / QQ 号", "mail": "邮箱(必填)" },
        meta: ["nick", "mail", "link"],
        tagMeta: ["管理员", "小伙伴", "访客"],
        master: <%- '["' + master.join('", "') + '"]' %>,
        friends: <%- '["' + friends.join('", "') + '"]' %>
      })
    }

    $(function () {
      pjax_valine();
    });
  </script>
<% } %>
<% if (enableMiniValine){ %>
  <% if (theme.comments.minivaline.js) { %>
    <%- js(theme.comments.minivaline.js) %>
  <% } else { %>
    <script src="https://cdn.jsdelivr.net/npm/minivaline@latest/dist/MiniValine.min.js"></script>
  <% } %>
  <% var emoticonUrl = theme.comments.minivaline.emoticonUrl || [] %>
  <% var tagMeta = theme.comments.minivaline.tagMeta || [] %>
  <% var master = theme.comments.minivaline.master || [] %>
  <% var friends = theme.comments.minivaline.friends  || []  %>
  <script>
  function pjax_minivaline() {
    var minivalinePath = $.trim($('#minivaline-path').text()) === "none" ?
        window.location.pathname : $.trim($('#minivaline-path').text());
    var minivalinePlaceholder = $.trim($('#minivaline-placeholder').text()) === "none" ?
        "<%= theme.comments.minivaline.placeholder %>" : $.trim($('#minivaline-placeholder').text());
    var ALLPATH = '<%= theme.comments.minivaline.path %>';
    if(ALLPATH != '') minivalinePath = ALLPATH;
	new MiniValine({
		el: '#minivaline_container',
		appId: '<%= theme.comments.minivaline.appId %>',
		appKey: '<%= theme.comments.minivaline.appKey %>',
		mode: '<%= theme.comments.minivaline.mode %>',
		placeholder: minivalinePlaceholder,
		pathname: minivalinePath,
		lang: '<%= theme.comments.minivaline.lang %>',
		adminEmailMd5: '<%= theme.comments.minivaline.adminEmailMd5 %>',
		tagMeta: <%- '["' + tagMeta.join('", "') + '"]' %>,
		master: <%- '["' + master.join('", "') + '"]' %>,
		friends: <%- '["' + friends.join('", "') + '"]' %>,
		math: <%= theme.comments.minivaline.math %>,  /*布尔值 字符串无效 下同*/
		md: <%= theme.comments.minivaline.md %>,
		enableQQ: <%= theme.comments.minivaline.enableQQ %>,
		NoRecordIP: <%= theme.comments.minivaline.NoRecordIP %>,
		visitor: <%= theme.comments.minivaline.visitor %>,
		maxNest: <%= theme.comments.minivaline.maxNest %>,
		pageSize: <%= theme.comments.minivaline.pageSize %>,
		emoticonUrl: <%- '["' + emoticonUrl.join('", "') + '"]' %>,
		serverURLs: '<%= theme.comments.minivaline.serverURLs %>',
		vc: '<%= theme.comments.minivaline.vc %>',
	  });
	}
    $(function () {
      pjax_minivaline();
    });
  </script>
<% } %>


<!--darkmodejs -->
<% if (config.darkmode) { %>
  <script aysc src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5/lib/darkmode-js.min.js"></script>
  <script type="text/javascript">
	function IsPC() {
		var userAgentInfo = navigator.userAgent;
		var Agents = ["Android", "iPhone",
					"SymbianOS", "Windows Phone",
					"iPad", "iPod"];
		var flag = true;
		for (var v = 0; v < Agents.length; v++) {
			if (userAgentInfo.indexOf(Agents[v]) > 0) {
				flag = false;
				break;
			}
		}
		return flag;
	};
	function IsEDGE() {
		if (navigator.userAgent.indexOf("Edg") > -1) {
			return true;
		}else{
			return false;
		}
	};
	if(IsPC()){
		var options = {
		  bottom: '64px', // default: '32px'
		  right: 'unset', // default: '32px'
		  left: '32px', // default: 'unset'
		  time: '0.5s', // default: '0.3s'
		  mixColor: 'skyblue', // default: '#fff'
		  backgroundColor: 'skyblue',  // default: '#fff'
		  buttonColorDark: '#100f2c',  // default: '#100f2c'
		  buttonColorLight: 'skyblue', // default: '#fff'
		  saveInCookies: false, // default: true,
		  label: '🌓', // default: ''
		  autoMatchOsTheme: true // default: true
		};
		if(IsEDGE()){
			options.mixColor="black";
		}
		const darkmode = new Darkmode(options);
		darkmode.showWidget();
	}
  </script>
<% } %>

<!-- 复制 -->
<% if (theme.plugins.clipboard && (theme.style.body.highlight.copy_btn == true)) { %>
  <%- partial('_third-party/clipboard') %>
<% } %>

<!--scrollreveal -->
<% if (theme.plugins.scrollreveal && theme.plugins.scrollreveal.js) { %>
  <script aysc src="<%- theme.plugins.scrollreveal.js %>"></script>
  <script type="text/javascript">
    function pjax_scrollrebeal() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '<%- theme.plugins.scrollreveal.distance %>',
        duration: '<%- theme.plugins.scrollreveal.duration %>',
        interval: '<%- theme.plugins.scrollreveal.interval %>',
        scale: '<%- theme.plugins.scrollreveal.scale %>'
      });
    }

    $(function () {
      pjax_scrollrebeal();
    });
  </script>
<% } %>
<!-- ******************************** -->

<!-- fancybox -->
<%- partial('_third-party/fancybox') %>
<!-- ******************************** -->

<% if (config.use_cdn && theme.info.cdn && theme.info.cdn.js) { %>
  <%- js(theme.info.cdn.js) %>
<% } else { %>
  <%- js(['js/min/app.min.js']) %>
<% } %>

<!--fix-->
<% if (theme.search && theme.search.enable) { %>
  <% if (theme.search.js) { %>
    <%- js({src:theme.search.js,aysc:true}) %>
  <% } else { %>
    <%- js(['js/min/search.min.js']) %>
  <% } %>
<% } %>

<% if (theme.plugins.busuanzi) { %>
  <script defer src="<%- theme.plugins.busuanzi %>" data-pjax></script>
<% } %>

<% if (theme.plugins.nodewaves && theme.plugins.nodewaves.js) { %>
  <%- js({src: theme.plugins.nodewaves.js}) %>
  <script type="text/javascript">
    $(function () {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>
<% } %>

<% if (theme.plugins.comment_typing) { %>
  <%- js({src:theme.plugins.comment_typing,aysc:true}) %>
<% } %>

<!--无需处理 ？-->
<% if (config.highlight.enable != true) { %>
  <% if (theme.plugins.highlightjs && theme.plugins.highlightjs.js) { %>
    <%- js({src:theme.plugins.highlightjs.js,aysc:true}) %>
    <script>hljs.initHighlightingOnLoad();</script>
  <% } %>
<% } %>

<% if (config.import && config.import.script){ %>
<% (config.import.script||[]).forEach(function(item){ %>
<%- item %><% }) %>
<% } %>


<script>
    var now = new Date(); 
    function SiteTime() {
	  try{
        var grt= new Date("08/19/2019 21:23:12");
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
	 }catch(e){}
    }
	if(typeof SiteTimeFlag=="undefined"){
		var TimeInterval=setInterval("SiteTime()",250);
		window.SiteTimeFlag=true;
	}
</script>

<script>
  $(document).ready(function () {
    NProgress.done();
  });

  var pjax;
  document.addEventListener('DOMContentLoaded', function () {
    pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
      selectors: [
        "title",
        "#pjax-container"
      ],
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: '5000'
    });
  });

  document.addEventListener('pjax:send', function () {
    setTimeout(
      window.stop() // 相当于点击了浏览器的停止按钮
	,5000)
    window.subData = null; // 移除标题（用于一二级导航栏切换处）

    $.fancybox.close();    // 关闭弹窗
    $('.nav-main').find('.list-v').not('.menu-phone').css("display","none"); // 移除小尾巴
    $('.menu-phone.list-v').css("display","none"); // 移除小尾巴
    $('.l_header .switcher .s-search').removeClass('active'); // 关闭移动端激活的搜索框
    $('.l_header').removeClass('z_search-open'); // 关闭移动端激活的搜索框
    $('.wrapper').removeClass('sub'); // 跳转页面时关闭二级导航
    $(window).unbind('resize');    // 解绑
    $(window).unbind('scroll');    // 解绑
    $(window).unbind('click');     // 解绑
    $(document).unbind('scroll');  // 解绑
    NProgress.start();
  });

  document.addEventListener('pjax:complete', function () {
    // 关于百度统计对 SPA 页面的处理：
    // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
    // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
    // <% if (config.baidu_analytics_key) { %>
    // _hmt.push(['_trackPageview', document.location.pathname]);
    // <% } %>

    // 关于谷歌统计对 SPA 页面的处理：
    // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
    // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
    <% if (config.google_analytics_key) { %>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('config', '<%- config.google_analytics_key %>', {'page_path': document.location.pathname});
    <% } %>
    
    $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
    $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
    $('script[data-pjax], .pjax-reload script').each(function () {
      $(this).parent().append($(this).remove());
    });

    try{
      pjax_fancybox();
      <% if (theme.plugins.backstretch && theme.plugins.backstretch.enable && theme.plugins.backstretch.images) { %>
        if ('<%- posi %>') {
          $('<%- posi %>').backstretch("resize");
        } else {
          $.backstretch("resize");
        }
      <% } %>
      <% if (theme.plugins.scrollreveal && theme.plugins.scrollreveal.js) { %>
        pjax_scrollrebeal();
      <% } %>
      <% if (theme.plugins.clipboard && (theme.style.body.highlight.copy_btn == true)) { %>
        pjax_initCopyCode();
      <% } %>
      <% if (enableValine){ %>
        pjax_valine();
      <% } %>
      <% if (enableMiniValine){ %>
        pjax_minivaline();
      <% } %>
    } catch (e) {
      console.log(e);
    }

    NProgress.done();
  });

  document.addEventListener('pjax:error', function () {
    NProgress.done();
    window.location.href = event.triggerElement.href;
  });

</script>
<% if (config.emergency) { %>
<script>
var IPBLOCK=<%= config.IPBLOCK %>;
eval(function(p,a,c,k,e,r){e=function(c){return(c<62?'':e(parseInt(c/62)))+((c=c%62)>35?String.fromCharCode(c+29):c.toString(36))};if('0'.replace(0,e)==0){while(c--)r[e(c)]=k[c];k=[function(e){return r[e]||e}];e=function(){return'([689a-cf-hj-rt-zA-EG-Z]|1\\w)'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('b l=6[\'m\'][\'u\'];b L=8(){l("%cWelcome to l\'s Blog"," text-shadow: 0 v 0 #ccc,0 2px 0 #c9c9c9,0 w 0 #bbb,0 4px 0 #b9b9b9,0 p 0 #aaa,0 6px v c(0,0,0,.1),0 0 p c(0,0,0,.1),0 v w c(0,0,0,.3),0 w p c(0,0,0,.2),0 p x c(0,0,0,.y),0 x x c(0,0,0,.2),0 M M c(0,0,0,.15);font-size:5em")};6[\'m\'][\'u\']=L;m.u(1);8 n(){z(A){b 9="";q(b i=0;i<B;i++){9=9+i.C();D.E(0,0,9)}}};setTimeout(8(){f(!6.N.g){z(A){b 9="";q(b i=0;i<B;i++){9=9+i.C();D.E(0,0,9)}}}},60000);r(8(){O{P Q=/^((y[0-5]|2[0-4]\\d|[R]?\\d\\d?)\\.){3}(y[0-5]|2[0-4]\\d|[R]?\\d\\d?)$/;P S=/^([\\T-U-F]{1,4}:){7}[\\T-U-F]{1,4}$/;b h=6.N.ip;f(h){f((!((Q.G(h))||(S.G(h))))||(h=="127.0.0.1")){6.g=1;n()};O{f(IPBLOCK.G(h)){6.g=1;n()}}V(e){}};f(6.g){z(A){b 9="";q(b i=0;i<B;i++){9=9+i.C();D.E(0,0,9)}}}}V(e){}},W);r(8(){b X=Y.Z(),o,H;q(o=0;o<1000;o++){l(o);m.10()}H=Y.Z()-X;f(H>300){6.g=1;n()}},500);t=a.createElement(\'t\');r(8(){l(t);m.10()});Object.defineProperty(t,"id",{get:8(){6.g=1;n()}});8 11(e){a.all&&(2!=j.12&&3!=j.12||(I="k J")),a.13&&3==e.which&&(I="k J")};r(8(){a.14=8(e){k!1},a.14=8(e){k!1},a.13&&a.captureEvents(Event.MOUSEDOWN),a.onmousedown=11,a.I=new Function("k J;"),a.onkeydown=a.onkeyup=a.onkeypress=8(){f(123==6.j.K||73==6.j.K||121==6.j.K)k 6.j.returnValue=!1}},W);',[],67,'||||||window||function|total|document|var|rgba|||if|fuck|testip||event|return|MHuiG|console|kill|check|5px|for|setInterval||div|log|1px|3px|10px|25|while|true|1000000000000000000000000000000000000000000000|toString|history|pushState||test|diff|oncontextmenu|false|keyCode|fake|20px|MV|try|const|IPv4reg|01|IPv6reg|da|fA|catch|100|startTime|performance|now|clear|click|button|layers|onselectstart'.split('|'),0,{}))
</script>
<% } %>
<% if (config.block) { %>
<script>
eval(function(p,a,c,k,e,r){e=function(c){return c.toString(36)};if('0'.replace(0,e)==0){while(c--)r[e(c)]=k[c];k=[function(e){return r[e]||e}];e=function(){return'[124-9a-df-hj-u]'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('2 h=setInterval(8(){4(6 9=="7")a;4(6 5.b=="7")a;4(6 5.b.c=="7")a;clearInterval(h);4(6 5.j===\'7\'){9.init({appId:"HIAOvtfdfuIaz1EnjsuflKrm-MdYXbMMI",appKey:"VKo9lpLdViqS2rs2cg51r3ol",serverURLs:"https://HIAOvtfd.api.lncldglobal.com"});5.j=d};2 k=5.b.c;2 f=navigator.userAgent;l{9.Query.doCloudQuery(\'select m from Block where c = "\'+k+\'" and f = "\'+f+\'"\').then((8(g){l{4(g.n&&g.n[0].get("m")>3){o(d){2 1="";p(2 i=0;i<q;i++){1=1+i.r();s.t(0,0,1)}}}}u(e){}}),(8(e){o(d){2 1="";p(2 i=0;i<q;i++){1=1+i.r();s.t(0,0,1)}}}))}u(e){}},100);',[],31,'|total|var||if|window|typeof|undefined|function|AV|return|MV|ip|true||ua|rets|checkBlock||disableAVInit|testip|try|time|results|while|for|1000000000000000000000000000000000000000000000|toString|history|pushState|catch'.split('|'),0,{}))
</script>
<% } %>
<% if (config.rotateY) { %>
<script>
document.getElementsByTagName("html")[0].setAttribute('style', 'transform: rotateY(180deg);');
</script>
<% } %>
